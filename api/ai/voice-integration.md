# ElevenLabs Voice Agent Integration

## Webhook Configuration

### Endpoint
The ElevenLabs voice agent should be configured to call:
```
POST https://api.foligo.tech/api/ai/voice-webhook
```

**Note**: This endpoint does NOT require authentication (no bearer token needed).

### Expected Payload
```json
{
  "summary": "String summary from voice conversation",
  "projectId": "uuid-of-project",
  "contentType": "BLOG" // Optional: "BLOG", "PROJECT", or "EXPERIENCE"
}
```

### Response
```json
{
  "success": true,
  "content": "Generated markdown content...",
  "title": "Extracted title from content",
  "metadata": {
    "mode": "create",
    "contentType": "BLOG",
    "generatedAt": "2024-...",
    "wordCount": 1234
  }
}
```

### Agent Configuration
- **Agent ID**: `agent_1301k8emq0nzfwmbyta7254adhpv`
- **First Message**: "Okay, let's get this down. Tell me all about the project... What was its main goal, and what problem were you trying to solve with it?"
- **Temperature**: Configure as needed for natural conversation

### Tool Configuration

The voice agent should be configured with this custom tool:

**Tool Name**: `process_portfolio_entry`

**Type**: Webhook

**Webhook URL**: `https://api.foligo.tech/api/ai/voice-webhook`

**Method**: POST

**Headers**:
```json
{
  "Content-Type": "application/json"
}
```

**Body**:
```json
{
  "summary": "{{summary}}",
  "projectId": "{{user_project_id}}",
  "contentType": "{{content_type}}"
}
```

**Response Handling**:
The webhook receives a summary from the voice agent and:
1. Processes it through Gemini to generate formatted content
2. Returns the generated content with title and metadata
3. The frontend will handle actually creating the content item

### Usage Flow

1. **Initialization**: User starts voice session. The agent needs to receive initial context:
   - `projectId`: UUID of the current project
   - `contentType`: "BLOG", "PROJECT", or "EXPERIENCE"
   
2. **Voice Conversation**: Agent conducts 3-question interview + final check following the agent configuration

3. **Content Generation**: Agent calls `process_portfolio_entry` tool with:
   - `summary`: Combined answers from the conversation
   - `projectId`: From initialization
   - `contentType`: From initialization

4. **Webhook Processing**: 
   - Webhook calls Gemini to generate content from summary
   - Returns generated content, title, and metadata

5. **Frontend Handling**: The frontend receives the voice completion and:
   - Creates the content item in the project using the generated content
   - Displays it to the user for review

### Dynamic Variables Setup

Configure these dynamic variables in ElevenLabs:
- `{{user_project_id}}`: Passed from frontend widget via `data-custom-variables`
- `{{content_type}}`: Passed from frontend widget via `data-custom-variables`
- `{{summary}}`: Generated by agent after conversation

The frontend passes variables like this:
```html
<elevenlabs-convai 
  agent-id="agent_1301k8emq0nzfwmbyta7254adhpv"
  dynamic-variables='{"user_project_id": "uuid", "content_type": "BLOG"}'
></elevenlabs-convai>
```

Note: The attribute is `dynamic-variables` (not `data-custom-variables`). This injects runtime values into the agent's messages, system prompts, and tools.

### Frontend Integration

The frontend now integrates voice mode:

#### In AIContentCreatorModal.vue:
- When user selects "Voice Mode", they see a prominent "Call AI Assistant" button
- The button uses `tel:` link to initiate phone call
- Session info is stored in `window.activeVoiceSession` for webhook callback

#### To Complete Integration:
1. Update the phone number in the HTML `href="tel:..."` 
2. Configure your ElevenLabs agent to:
   - Receive `{{project_id}}` and `{{content_type}}` as dynamic variables
   - Call the webhook with these values when `process_portfolio_entry` tool is triggered
3. The webhook will generate content and the frontend will automatically create the content item

### Environment Variables Needed

Add to API `.env`:
```
ELEVENLABS_API_KEY=your_api_key_here
ELEVENLABS_AGENT_ID=agent_1301k8emq0nzfwmbyta7254adhpv
```

